--create database BankingDB
USE BankingDB

DROP TABLE CHAT_PARTICIPANTS;
DROP TABLE FRIENDS;
DROP TABLE REPORTS;
DROP TABLE NOTIFICATIONS;
DROP TABLE MESSAGES;
DROP TABLE CHATS;
DROP TABLE MESSAGE_TYPE;
DROP TABLE USERS;
DROP TABLE FEED_POSTS;

CREATE TABLE USERS (
UserID INT PRIMARY KEY IDENTITY ,
Username VARCHAR(255) NOT NULL,
PhoneNumber VARCHAR(20) NOT NULL,
ReportedCount INT DEFAULT 0,
);

CREATE TABLE CHATS (
ChatID INT PRIMARY KEY IDENTITY,
ChatName VARCHAR(255)
)

CREATE TABLE CHAT_PARTICIPANTS (
ChatID INT,
UserID INT,
PRIMARY KEY (ChatID, UserID),
FOREIGN KEY (ChatID) REFERENCES CHATS(ChatID) ON DELETE CASCADE,
FOREIGN KEY (UserID) REFERENCES USERS(UserID) ON DELETE CASCADE
);

CREATE TABLE FRIENDS (
FriendID INT ,
UserID INT,
PRIMARY KEY (FriendID, UserID),
FOREIGN KEY (UserID) REFERENCES USERS(UserID) ,
FOREIGN KEY (FriendID) REFERENCES USERS(UserID)
);

CREATE TABLE MESSAGE_TYPE (
TypeID INT PRIMARY KEY IDENTITY,
TypeName VARCHAR(255) NOT NULL
);

CREATE TABLE MESSAGES (
MessageID INT PRIMARY KEY IDENTITY,
TypeID INT,
UserID INT,
ChatID INT,
Timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
Content NVARCHAR(260),
Status VARCHAR(255) DEFAULT NULL,
Amount DECIMAL(10,2) DEFAULT NULL,
Currency VARCHAR(10) DEFAULT NULL,
FOREIGN KEY (TypeID) REFERENCES MESSAGE_TYPE(TypeID) ON DELETE SET NULL,
FOREIGN KEY (UserID) REFERENCES USERS(UserID) ON DELETE CASCADE,
FOREIGN KEY (ChatID) REFERENCES CHATS(ChatID) ON DELETE CASCADE
);

CREATE TABLE REPORTS (
ReportID INT PRIMARY KEY IDENTITY,
MessageID INT,
Reason VARCHAR(255) NOT NULL,
Description VARCHAR(255) DEFAULT NULL,
Status VARCHAR(50),
FOREIGN KEY (MessageID) REFERENCES MESSAGES(MessageID) ON DELETE CASCADE
);

CREATE TABLE NOTIFICATIONS (
NotifID INT PRIMARY KEY IDENTITY,
Timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
Content VARCHAR(255) NOT NULL,
UserID INT,
FOREIGN KEY (UserID) REFERENCES USERS(UserID) ON DELETE CASCADE
);

CREATE TABLE FEED_POSTS (
PostID INT PRIMARY KEY IDENTITY,
Title VARCHAR(255) NOT NULL,
Category VARCHAR(255) NOT NULL,
Content VARCHAR(255) NOT NULL,
Timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);
